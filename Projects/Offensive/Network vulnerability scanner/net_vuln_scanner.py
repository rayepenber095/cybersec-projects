#!/usr/bin/env python3
"""
Network Vulnerability Scanner (Educational)
Scans open TCP ports and identifies basic services.

Author: awjunaid
"""

import socket
import threading
from datetime import datetime

# Common ports to check (you can expand this list)
COMMON_PORTS = {
    21: "FTP",      # File Transfer Protocol
    22: "SSH",      # Secure Shell
    23: "Telnet",   # Telnet (unencrypted remote access)
    25: "SMTP",     # Simple Mail Transfer Protocol
    53: "DNS",      # Domain Name System
    80: "HTTP",     # Web traffic (unencrypted)
    110: "POP3",    # Post Office Protocol v3
    139: "NetBIOS", # Windows file sharing
    143: "IMAP",    # Internet Message Access Protocol
    443: "HTTPS",   # Secure web traffic
    445: "SMB",     # Server Message Block (file sharing)
    3306: "MySQL",  # MySQL database
    3389: "RDP",    # Remote Desktop Protocol
    8080: "HTTP-Alt", # Alternative HTTP port
}

# Global list to store discovered open ports
open_ports = []
# Thread lock to prevent race conditions when modifying shared data
lock = threading.Lock()

def scan_port(host, port, timeout=1):
    """Try to connect to a TCP port."""
    try:
        # Create TCP socket (AF_INET = IPv4, SOCK_STREAM = TCP)
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.settimeout(timeout)  # Set connection timeout
            # connect_ex returns 0 if connection successful, error code otherwise
            result = s.connect_ex((host, port))
            if result == 0:
                # Connection successful - port is open
                with lock:
                    service = COMMON_PORTS.get(port, "Unknown")
                    print(f"[+] {host}:{port} open ({service})")
                    open_ports.append((port, service))
    except Exception:
        # Silently handle any exceptions (timeout, network errors, etc.)
        pass

def scan_host(host):
    """Main scanning function that coordinates port scanning threads"""
    print(f"\n[*] Scanning {host} ...")
    start_time = datetime.now()

    # Create and start a thread for each port
    threads = []
    for port in COMMON_PORTS.keys():
        t = threading.Thread(target=scan_port, args=(host, port))
        t.start()
        threads.append(t)

    # Wait for all threads to complete
    for t in threads:
        t.join()

    # Calculate and display scan duration
    scan_duration = datetime.now() - start_time
    print(f"\nScan completed in {scan_duration}")
    
    # Sort results by port number for consistent output
    sorted_ports = sorted(open_ports)
    print(f"Open ports: {len(sorted_ports)}")
    
    # Display results
    for port, service in sorted_ports:
        print(f"  - {port}/tcp ({service})")

    # Save results to file
    with open("scan_report.txt", "w") as f:
        for port, service in sorted_ports:
            f.write(f"{host}:{port} open ({service})\n")
    print(f"\nResults saved to scan_report.txt")

if __name__ == "__main__":
    # Get target from user input
    target = input("Enter target IP or hostname: ").strip()
    scan_host(target)
